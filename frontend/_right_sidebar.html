<div id="right-sidebar" class="sidebar right-sidebar">
    <div class="sidebar-header">
        <h3>ì•Œë¦¼ & ë„ì›€ë§</h3>
        <button class="sidebar-toggle" onclick="toggleRightSidebar()">Ã—</button>
    </div>
    <div class="sidebar-content">
        <div class="notifications">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
                <h4 style="margin:0">ì‹¤ì‹œê°„ ì•Œë¦¼</h4>
                <button onclick="readAllNotifications()" style="background:none;border:none;color:#1565c0;font-size:12px;cursor:pointer;padding:4px 8px;border-radius:4px;transition:background 0.2s" onmouseover="this.style.background='#e3f2fd'" onmouseout="this.style.background='none'">ëª¨ë‘ ì½ìŒ</button>
            </div>
            <div id="notifications-list"><div class="loading-text">ë¡œë”© ì¤‘...</div></div>
        </div>
        <div class="stats-widget">
            <h4>ì˜¤ëŠ˜ì˜ í†µê³„</h4>
            <div class="stat-cards">
                <div class="stat-card">
                    <div class="stat-number" id="total-searches">-</div>
                    <div class="stat-label">ì´ ê²€ìƒ‰</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="high-risk-count">-</div>
                    <div class="stat-label">ìœ„í—˜ ì§€ì—­</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-reports">-</div>
                    <div class="stat-label">ì‹ ê³  ê±´ìˆ˜</div>
                </div>
            </div>
        </div>
        <div class="help-section">
            <h4>ë„ì›€ë§</h4>
            <div class="help-items">
                <div class="help-item" onclick="showTooltip('search-help')"><span class="help-icon">ğŸ”</span><span>ê²€ìƒ‰ ë°©ë²•</span></div>
                <div class="help-item" onclick="showTooltip('map-help')"><span class="help-icon">ğŸ—ºï¸</span><span>ì§€ë„ ì‚¬ìš©ë²•</span></div>
                <div class="help-item" onclick="showTooltip('safety-help')"><span class="help-icon">ğŸ›¡ï¸</span><span>ì•ˆì „ ìˆ˜ì¹™</span></div>
                <div class="help-item" onclick="showTooltip('report-help')"><span class="help-icon">ğŸ“¢</span><span>ì‹ ê³  ë°©ë²•</span></div>
            </div>
        </div>
        <div class="related-links">
            <h4>ê´€ë ¨ ë§í¬</h4>
            <div class="link-items">
                <a href="https://www.114.co.kr/" target="_blank">114 ì „í™”ë²ˆí˜¸</a>
                <a href="https://www.ftc.go.kr/" target="_blank">ê³µì •ê±°ë˜ìœ„ì›íšŒ</a>
                <a href="https://www.kbstar.com/" target="_blank">KBë¶€ë™ì‚°</a>
                <a href="https://www.zigbang.com/" target="_blank">ì§ë°©</a>
            </div>
        </div>
    </div>
</div>
<div id="tooltip-modal" class="tooltip-modal hidden">
    <div class="tooltip-content">
        <button class="tooltip-close" onclick="hideTooltip()">Ã—</button>
        <div id="tooltip-text"></div>
    </div>
</div>
<style>
.right-sidebar{position:fixed;right:0;top:70px;width:300px;height:calc(100vh - 70px);background:white;box-shadow:-2px 0 8px rgba(0,0,0,0.1);z-index:999;overflow-y:auto;transition:transform 0.3s ease;transform:translateX(100%)}
.right-sidebar.active{transform:translateX(0)}
.sidebar-header{padding:20px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center;background:#f8f9fa}
.sidebar-header h3{margin:0;font-size:16px;color:#333}
.sidebar-toggle{background:none;border:none;font-size:20px;cursor:pointer;color:#666}
.sidebar-content{padding:20px}
.sidebar-content h4{margin:0 0 12px 0;font-size:14px;color:#555;font-weight:600}
.sidebar-content>div{margin-bottom:24px}
.notification-item{padding:12px;margin:8px 0;border-radius:6px;border-left:4px solid #ddd;cursor:pointer;transition:all 0.2s}
.notification-item.unread{background:#f8f9fa;border-left-color:var(--brand-600)}
.notification-item.warning{border-left-color:#ffc107}
.notification-item.danger{border-left-color:#dc3545}
.notification-item.success{border-left-color:#28a745}
.notification-title{font-weight:600;font-size:14px;margin-bottom:4px}
.notification-message{font-size:13px;color:#666;margin-bottom:4px}
.notification-time{font-size:12px;color:#999}
.stat-cards{display:grid;grid-template-columns:1fr;gap:12px}
.stat-card{background:#f8f9fa;padding:16px;border-radius:8px;text-align:center;border:1px solid #e9ecef}
.stat-number{font-size:24px;font-weight:700;color:var(--brand-600);margin-bottom:4px}
.stat-label{font-size:12px;color:#666}
.help-items{display:flex;flex-direction:column;gap:8px}
.help-item{display:flex;align-items:center;gap:12px;padding:12px;background:#f8f9fa;border-radius:6px;cursor:pointer;transition:background 0.2s}
.help-item:hover{background:#e9ecef}
.help-icon{font-size:18px}
.link-items{display:flex;flex-direction:column;gap:8px}
.link-items a{display:block;padding:8px 12px;color:#555;text-decoration:none;border-radius:4px;transition:all 0.2s;font-size:14px}
.link-items a:hover{background:#f8f9fa;color:var(--brand-600)}
.tooltip-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:9999;display:flex;align-items:center;justify-content:center}
.tooltip-modal.hidden{display:none}
.tooltip-content{background:white;padding:24px;border-radius:8px;max-width:500px;width:90%;max-height:80vh;overflow-y:auto;position:relative}
.tooltip-close{position:absolute;top:12px;right:12px;background:none;border:none;font-size:20px;cursor:pointer;color:#666}
.loading-text{color:#666;font-size:14px;text-align:center;padding:20px}
</style>
<script>
// toggleRightSidebarëŠ” _navbar.htmlì— ì´ë¯¸ ì •ì˜ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ì œê±°
// function toggleRightSidebar()ëŠ” _navbar.htmlì—ì„œ ì •ì˜ë¨

function showTooltip(t){const m=document.getElementById('tooltip-modal');const txt=document.getElementById('tooltip-text');const tips={'search-help':'<h3>ğŸ” ê²€ìƒ‰ ë°©ë²•</h3><p><strong>ê¸°ë³¸ ê²€ìƒ‰:</strong> ì§€ì—­ëª…(ì˜ˆ: í™”ê³¡ë™)ì„ ì…ë ¥í•˜ê³  ê²€ìƒ‰ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p><p><strong>ê³ ê¸‰ ê²€ìƒ‰:</strong> ê°€ê²©ëŒ€, ê±´ë¬¼ ìœ í˜•, ìœ„í—˜ë„ ë“±ì„ ì„¤ì •í•˜ì—¬ ë” ì •í™•í•œ ê²€ìƒ‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p><strong>ì¦ê²¨ì°¾ê¸°:</strong> ìì£¼ ê²€ìƒ‰í•˜ëŠ” ì§€ì—­ì„ ì¦ê²¨ì°¾ê¸°ì— ì¶”ê°€í•˜ì—¬ ë¹ ë¥´ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>','map-help':'<h3>ğŸ—ºï¸ ì§€ë„ ì‚¬ìš©ë²•</h3><p><strong>ìƒ‰ìƒ ì˜ë¯¸:</strong> ë¹¨ê°„ìƒ‰(ìœ„í—˜), ë…¸ë€ìƒ‰(ì£¼ì˜), ì´ˆë¡ìƒ‰(ì•ˆì „)</p><p><strong>ì› í´ë¦­:</strong> ì§€ì—­ì„ í´ë¦­í•˜ë©´ í•´ë‹¹ ì§€ì—­ì˜ ìƒì„¸ ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><strong>í•„í„°ë§:</strong> ì‚¬ì´ë“œ íŒ¨ë„ì—ì„œ ìœ„í—˜ë„ë³„ë¡œ í•„í„°ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><strong>ê²€ìƒ‰:</strong> ìƒë‹¨ ê²€ìƒ‰ì°½ì—ì„œ íŠ¹ì • ì§€ì—­ì„ ì°¾ì•„ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>','safety-help':'<h3>ğŸ›¡ï¸ ì•ˆì „ ìˆ˜ì¹™</h3><p><strong>ê³„ì•½ ì „ í•„ìˆ˜ í™•ì¸:</strong></p><ul><li>ë“±ê¸°ë¶€ë“±ë³¸ í™•ì¸</li><li>ê±´ì¶•ë¬¼ëŒ€ì¥ í™•ì¸</li><li>ì„ëŒ€ì¸ ì‹ ë¶„ì¦ í™•ì¸</li><li>ì„ ìˆœìœ„ ì„¸ì…ì í™•ì¸</li><li>ì§‘ì£¼ì¸ ì„¸ê¸ˆ ì²´ë‚© ì¡°íšŒ</li></ul><p><strong>ì£¼ì˜ì‚¬í•­:</strong> ì‹œì„¸ë³´ë‹¤ í˜„ì €íˆ ë‚®ì€ ê°€ê²©, ê¸‰í•œ ê³„ì•½ ìš”êµ¬, ì„œë¥˜ ì œì‹œ ê±°ë¶€ ë“±ì€ ìœ„í—˜ ì‹ í˜¸ì…ë‹ˆë‹¤.</p>','report-help':'<h3>ğŸ“¢ ì‹ ê³  ë°©ë²•</h3><p><strong>ì‹ ê³  ê°€ëŠ¥í•œ ê²½ìš°:</strong></p><ul><li>ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ë§¤ë¬¼</li><li>ì „ì„¸ì‚¬ê¸° ì˜ì‹¬</li><li>ê°€ì§œ ë§¤ë¬¼</li><li>ë¶€ì •í•œ ì¤‘ê°œì—…ì†Œ</li></ul><p><strong>ì‹ ê³  ì ˆì°¨:</strong> ë§¤ë¬¼ ë¶„ì„ í˜ì´ì§€ì—ì„œ ì‹ ê³  ë²„íŠ¼ì„ í´ë¦­í•˜ê³  ìƒì„¸ ë‚´ìš©ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.</p>'};txt.innerHTML=tips[t]||'<p>ë„ì›€ë§ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';m.classList.remove('hidden')}
function hideTooltip(){document.getElementById('tooltip-modal').classList.add('hidden')}
function loadNotifications(){fetch('/api/notifications').then(r=>{if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return r.json()}).then(d=>{const c=document.getElementById('notifications-list');if(!c)return;if(!d||d.length===0){c.innerHTML='<div class="loading-text">ìƒˆë¡œìš´ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>';return}let u=0;c.innerHTML=d.map(n=>{const uc=n.user_id!==null&&n.user_id!==undefined;if(uc)u++;return`<div class="notification-item ${n.is_read?'':'unread'} ${n.type||'info'}" onclick="markAsRead(${n.id})"><div class="notification-title">${n.title||'ì•Œë¦¼'}</div><div class="notification-message">${n.message||''}</div><div class="notification-time">${n.created_at||''}</div></div>`}).join('');window.userNotificationCount=u}).catch(e=>{const c=document.getElementById('notifications-list');if(c)c.innerHTML='<div class="loading-text">ì•Œë¦¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>'})}
function markAsRead(n){fetch('/api/notifications',{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({id:n})}).then(r=>r.json()).then(d=>{loadNotifications()})}
function loadStats(){fetch('/api/stats').then(r=>r.json()).then(d=>{document.getElementById('total-searches').textContent=d.total_searches||0;document.getElementById('high-risk-count').textContent=d.high_risk_regions||0;document.getElementById('total-reports').textContent=d.total_reports||0}).catch(e=>console.error('í†µê³„ ë¡œë“œ ì‹¤íŒ¨:',e))}
function readAllNotifications(){fetch('/api/notifications/read-all',{method:'POST',headers:{'Content-Type':'application/json'},credentials:'same-origin'}).then(r=>{if(!r.ok){if(r.status===401){window.location.href='/login';return}throw new Error(`HTTP error! status: ${r.status}`)}return r.json()}).then(d=>{if(d&&d.status==='success'){loadNotifications()}else if(d){alert(d.message||'ì½ìŒ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')}}).catch(e=>{console.error('Error:',e);alert('ì½ìŒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')})}
document.addEventListener('DOMContentLoaded',function(){const s=document.getElementById('right-sidebar')||document.querySelector('.right-sidebar');if(s){s.classList.remove('active');s.style.transform='translateX(100%)'}});
document.addEventListener('click',e=>{const m=document.getElementById('tooltip-modal');if(e.target===m)hideTooltip()});
</script>
